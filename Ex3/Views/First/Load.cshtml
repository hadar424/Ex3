
@{
    ViewBag.Title = "Load";
}

<html style="overflow:hidden">


<body style="margin:0">

    <canvas id="myCanvas" style="width:100%; height:100%;position:absolute;background-size:100% 100%; margin:0; background-image:url('/export-map-share.png')"></canvas>

    <script>


        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");

            c.width = window.innerWidth;
            c.height = window.innerHeight;
            ctx.width = window.innerWidth;
            ctx.height = window.innerHeight;

       var oldLon = 200;
        var oldLat= 200;

        var IntervalTime = 1000 / @Session["time"]
        myTimer = (function () {
            $.post("@Url.Action("GetLonLatFile")").done(function (xml) {
                if (xml == "") {
                    alert("check");
                    clearInterval(interval)
                }
            var xmlDoc = $.parseXML(xml),
                $xml = $(xmlDoc);
            lon = $xml.find("Lon").text();
            lat = $xml.find("Lat").text();

            lon =  parseFloat(lon);
            lat = parseFloat(lat);
            var newLon = (lon + 180) * (c.width / 360);
            var newLat = (lat - 90) * (c.height / -180);
            if (oldLon == 200 && oldLat == 200) {
                ctx.beginPath();
                ctx.arc(newLon, newLat, 2, 0, 2 * Math.PI);
                ctx.fillStyle = 'red';
                ctx.fill();
                ctx.strokeStyle = 'red';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.closePath();
                oldLon = newLon;
                oldLat = newLat;
            } else {
                ctx.moveTo(oldLon, oldLat);
                ctx.lineTo(newLon, newLat);
                ctx.strokeStyle = 'red';
                ctx.lineWidth = 2;
                ctx.stroke();
                oldLon = newLon;
                oldLat = newLat;
            }

            });
        });



        var interval = setInterval(myTimer, IntervalTime);
        myTimer();

    </script>

</body>
</html>